<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lja.oa.dao.UserMapper">
    <resultMap id="BaseResultMap" type="com.lja.oa.pojo.User">
        <!-- WARNING - @mbggenerated This element is automatically generated by
			MyBatis Generator, do not modify. This element was generated on Wed Nov 08
			11:16:16 CST 2017. -->
        <id column="USER_ID" property="userId" jdbcType="BIGINT" />
        <result column="ORG_ID" property="orgId" jdbcType="BIGINT" />
        <result column="USER_NAME" property="userName" jdbcType="CHAR" />
        <result column="USER_PASSWORD" property="userPassword"
                jdbcType="CHAR" />
        <result column="MOBILE_PHONE" property="mobilePhone" jdbcType="CHAR" />
        <result column="EMAIL" property="email" jdbcType="CHAR" />
        <result column="USER_CH_NAME" property="userChName" jdbcType="CHAR" />
        <result column="USER_BIRTHDAY" property="userBirthday"
                jdbcType="DATE" />
        <result column="USER_SEX" property="userSex" jdbcType="SMALLINT" />
        <result column="USER_PHOTO_URL" property="userPhotoUrl"
                jdbcType="CHAR" />
        <result column="PROVINCE_ID" property="provinceId" jdbcType="INTEGER" />
        <result column="PROVINCE_NAME" property="provinceName"
                jdbcType="CHAR" />
        <result column="CITY_ID" property="cityId" jdbcType="INTEGER" />
        <result column="CITY_NAME" property="cityName" jdbcType="CHAR" />
        <result column="COUNTRY_ID" property="countryId" jdbcType="INTEGER" />
        <result column="CONTRY_NAME" property="contryName" jdbcType="CHAR" />
        <result column="HOBBY" property="hobby" jdbcType="CHAR" />
        <result column="INTRODUCE" property="introduce" jdbcType="VARCHAR" />
        <result column="MANAGER_ID" property="managerId" jdbcType="INTEGER" />
        <result column="CREATED_DATE" property="createdDate" jdbcType="TIMESTAMP" />
    </resultMap>

    <resultMap type="users" id="usersMap" extends="BaseResultMap">
        <result property="orgName" column="orgName"/>
    </resultMap>

    <sql id="Base_Column_List">
        <!-- WARNING - @mbggenerated This element is automatically generated by
			MyBatis Generator, do not modify. This element was generated on Wed Nov 08
			11:16:16 CST 2017. -->
        USER_ID, ORG_ID, USER_NAME, USER_PASSWORD, MOBILE_PHONE, EMAIL,
        USER_CH_NAME, USER_BIRTHDAY,
        USER_SEX, USER_PHOTO_URL, PROVINCE_ID, PROVINCE_NAME, CITY_ID, CITY_NAME,
        COUNTRY_ID,
        CONTRY_NAME, HOBBY, INTRODUCE, MANAGER_ID, CREATED_DATE
    </sql>

    <sql id="Base_users_List">
        USER_ID, U.ORG_ID, USER_NAME, USER_PASSWORD, MOBILE_PHONE, EMAIL,
        USER_CH_NAME, USER_BIRTHDAY,
        USER_SEX, USER_PHOTO_URL, PROVINCE_ID, PROVINCE_NAME, CITY_ID, CITY_NAME,
        COUNTRY_ID,
        CONTRY_NAME, HOBBY, INTRODUCE, MANAGER_ID, U.CREATED_DATE,O.ORG_NAME as orgName
    </sql>

    <select id="selectByPrimaryKey" resultMap="BaseResultMap"
            parameterType="java.lang.Long">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. This element was generated on Wed Nov 08
            11:16:16 CST 2017. -->
        select
        <include refid="Base_Column_List" />
        from sys_user
        where USER_ID = #{userId,jdbcType=BIGINT}
    </select>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. This element was generated on Wed Nov 08
            11:16:16 CST 2017. -->
        delete from sys_user
        where USER_ID = #{userId,jdbcType=BIGINT}
    </delete>

    <insert id="insert" parameterType="com.lja.oa.pojo.User">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. This element was generated on Wed Nov 08
            11:16:16 CST 2017. -->
        insert into sys_user (USER_ID, ORG_ID, USER_NAME,
        USER_PASSWORD, MOBILE_PHONE, EMAIL,
        USER_CH_NAME, USER_BIRTHDAY, USER_SEX,
        USER_PHOTO_URL, PROVINCE_ID, PROVINCE_NAME,
        CITY_ID, CITY_NAME, COUNTRY_ID,
        CONTRY_NAME, HOBBY, INTRODUCE,
        MANAGER_ID, CREATED_DATE)
        values (#{userId,jdbcType=BIGINT}, #{orgId,jdbcType=BIGINT},
        #{userName,jdbcType=CHAR},
        #{userPassword,jdbcType=CHAR}, #{mobilePhone,jdbcType=CHAR}, #{email,jdbcType=CHAR},
        #{userChName,jdbcType=CHAR}, #{userBirthday,jdbcType=DATE},
        #{userSex,jdbcType=SMALLINT},
        #{userPhotoUrl,jdbcType=CHAR}, #{provinceId,jdbcType=INTEGER}, #{provinceName,jdbcType=CHAR},
        #{cityId,jdbcType=INTEGER}, #{cityName,jdbcType=CHAR},
        #{countryId,jdbcType=INTEGER},
        #{contryName,jdbcType=CHAR}, #{hobby,jdbcType=CHAR}, #{introduce,jdbcType=VARCHAR},
        #{managerId,jdbcType=INTEGER}, #{createdDate,jdbcType=TIMESTAMP})
    </insert>

    <insert id="insertSelective" parameterType="com.lja.oa.pojo.User">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. This element was generated on Wed Nov 08
            11:16:16 CST 2017. -->
        insert into sys_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userId != null">
                USER_ID,
            </if>
            <if test="orgId != null">
                ORG_ID,
            </if>
            <if test="userName != null">
                USER_NAME,
            </if>
            <if test="userPassword != null">
                USER_PASSWORD,
            </if>
            <if test="mobilePhone != null">
                MOBILE_PHONE,
            </if>
            <if test="email != null">
                EMAIL,
            </if>
            <if test="userChName != null">
                USER_CH_NAME,
            </if>
            <if test="userBirthday != null">
                USER_BIRTHDAY,
            </if>
            <if test="userSex != null">
                USER_SEX,
            </if>
            <if test="userPhotoUrl != null">
                USER_PHOTO_URL,
            </if>
            <if test="provinceId != null">
                PROVINCE_ID,
            </if>
            <if test="provinceName != null">
                PROVINCE_NAME,
            </if>
            <if test="cityId != null">
                CITY_ID,
            </if>
            <if test="cityName != null">
                CITY_NAME,
            </if>
            <if test="countryId != null">
                COUNTRY_ID,
            </if>
            <if test="contryName != null">
                CONTRY_NAME,
            </if>
            <if test="hobby != null">
                HOBBY,
            </if>
            <if test="introduce != null">
                INTRODUCE,
            </if>
            <if test="managerId != null">
                MANAGER_ID,
            </if>
            <if test="createdDate != null">
                CREATED_DATE,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="userId != null">
                #{userId,jdbcType=BIGINT},
            </if>
            <if test="orgId != null">
                #{orgId,jdbcType=BIGINT},
            </if>
            <if test="userName != null">
                #{userName,jdbcType=CHAR},
            </if>
            <if test="userPassword != null">
                #{userPassword,jdbcType=CHAR},
            </if>
            <if test="mobilePhone != null">
                #{mobilePhone,jdbcType=CHAR},
            </if>
            <if test="email != null">
                #{email,jdbcType=CHAR},
            </if>
            <if test="userChName != null">
                #{userChName,jdbcType=CHAR},
            </if>
            <if test="userBirthday != null">
                #{userBirthday,jdbcType=DATE},
            </if>
            <if test="userSex != null">
                #{userSex,jdbcType=SMALLINT},
            </if>
            <if test="userPhotoUrl != null">
                #{userPhotoUrl,jdbcType=CHAR},
            </if>
            <if test="provinceId != null">
                #{provinceId,jdbcType=INTEGER},
            </if>
            <if test="provinceName != null">
                #{provinceName,jdbcType=CHAR},
            </if>
            <if test="cityId != null">
                #{cityId,jdbcType=INTEGER},
            </if>
            <if test="cityName != null">
                #{cityName,jdbcType=CHAR},
            </if>
            <if test="countryId != null">
                #{countryId,jdbcType=INTEGER},
            </if>
            <if test="contryName != null">
                #{contryName,jdbcType=CHAR},
            </if>
            <if test="hobby != null">
                #{hobby,jdbcType=CHAR},
            </if>
            <if test="introduce != null">
                #{introduce,jdbcType=VARCHAR},
            </if>
            <if test="managerId != null">
                #{managerId,jdbcType=INTEGER},
            </if>
            <if test="createdDate != null">
                #{createdDate,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>

    <update id="updateByPrimaryKeySelective" parameterType="com.lja.oa.pojo.User">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. This element was generated on Wed Nov 08
            11:16:16 CST 2017. -->
        update sys_user
        <set>
            <if test="orgId != null">
                ORG_ID = #{orgId,jdbcType=BIGINT},
            </if>
            <if test="userName != null">
                USER_NAME = #{userName,jdbcType=CHAR},
            </if>
            <if test="userPassword != null">
                USER_PASSWORD = #{userPassword,jdbcType=CHAR},
            </if>
            <if test="mobilePhone != null">
                MOBILE_PHONE = #{mobilePhone,jdbcType=CHAR},
            </if>
            <if test="email != null">
                EMAIL = #{email,jdbcType=CHAR},
            </if>
            <if test="userChName != null">
                USER_CH_NAME = #{userChName,jdbcType=CHAR},
            </if>
            <if test="userBirthday != null">
                USER_BIRTHDAY = #{userBirthday,jdbcType=DATE},
            </if>
            <if test="userSex != null">
                USER_SEX = #{userSex,jdbcType=SMALLINT},
            </if>
            <if test="userPhotoUrl != null">
                USER_PHOTO_URL = #{userPhotoUrl,jdbcType=CHAR},
            </if>
            <if test="provinceId != null">
                PROVINCE_ID = #{provinceId,jdbcType=INTEGER},
            </if>
            <if test="provinceName != null">
                PROVINCE_NAME = #{provinceName,jdbcType=CHAR},
            </if>
            <if test="cityId != null">
                CITY_ID = #{cityId,jdbcType=INTEGER},
            </if>
            <if test="cityName != null">
                CITY_NAME = #{cityName,jdbcType=CHAR},
            </if>
            <if test="countryId != null">
                COUNTRY_ID = #{countryId,jdbcType=INTEGER},
            </if>
            <if test="contryName != null">
                CONTRY_NAME = #{contryName,jdbcType=CHAR},
            </if>
            <if test="hobby != null">
                HOBBY = #{hobby,jdbcType=CHAR},
            </if>
            <if test="introduce != null">
                INTRODUCE = #{introduce,jdbcType=VARCHAR},
            </if>
            <if test="managerId != null">
                MANAGER_ID = #{managerId,jdbcType=INTEGER},
            </if>
            <if test="createdDate != null">
                CREATED_DATE = #{createdDate,jdbcType=TIMESTAMP},
            </if>
        </set>
        where USER_ID = #{userId,jdbcType=BIGINT}
    </update>

    <update id="updateByPrimaryKey" parameterType="com.lja.oa.pojo.User">
        <!-- WARNING - @mbggenerated This element is automatically generated by
            MyBatis Generator, do not modify. This element was generated on Wed Nov 08
            11:16:16 CST 2017. -->
        update sys_user
        set ORG_ID = #{orgId,jdbcType=BIGINT},
        USER_NAME = #{userName,jdbcType=CHAR},
        USER_PASSWORD = #{userPassword,jdbcType=CHAR},
        MOBILE_PHONE = #{mobilePhone,jdbcType=CHAR},
        EMAIL = #{email,jdbcType=CHAR},
        USER_CH_NAME = #{userChName,jdbcType=CHAR},
        USER_BIRTHDAY = #{userBirthday,jdbcType=DATE},
        USER_SEX = #{userSex,jdbcType=SMALLINT},
        USER_PHOTO_URL = #{userPhotoUrl,jdbcType=CHAR},
        PROVINCE_ID = #{provinceId,jdbcType=INTEGER},
        PROVINCE_NAME = #{provinceName,jdbcType=CHAR},
        CITY_ID = #{cityId,jdbcType=INTEGER},
        CITY_NAME = #{cityName,jdbcType=CHAR},
        COUNTRY_ID = #{countryId,jdbcType=INTEGER},
        CONTRY_NAME = #{contryName,jdbcType=CHAR},
        HOBBY = #{hobby,jdbcType=CHAR},
        INTRODUCE = #{introduce,jdbcType=VARCHAR},
        MANAGER_ID = #{managerId,jdbcType=INTEGER},
        CREATED_DATE = #{createdDate,jdbcType=TIMESTAMP}
        where USER_ID = #{userId,jdbcType=BIGINT}
    </update>

    <!-- 查询分页数据 -->
    <select id="getUserList" parameterType="map" resultMap="BaseResultMap">
        SELECT 
            <include refid="Base_Column_List"/>
        from sys_user U WHERE 1=1
        <if test="orgId != null and orgId != '' ">
            AND U.ORG_ID = #{orgId,jdbcType=BIGINT}
        </if>

        <if test="mobilePhone != null and mobilePhone != '' ">
            AND U.MOBILE_PHONE = #{mobilePhone,jdbcType=VARCHAR}
        </if>

        <if test="userChName != null and userChName != '' ">
            AND U.USER_CH_NAME like
            CONCAT(CONCAT('%',#{userChName,jdbcType=VARCHAR}),'%')
        </if>

        <if test="provinceId != null and provinceId != '' ">
            AND U.PROVINCE_ID = #{provinceId,jdbcType=BIGINT}
        </if>

        <if test="cityId != null and cityId != '' ">
            AND U.CITY_ID = #{cityId,jdbcType=BIGINT}
        </if>

        <if test="countryId != null and countryId != '' ">
            AND U.COUNTRY_ID = #{countryId,jdbcType=BIGINT}
        </if>
        ORDER BY U.CREATED_DATE DESC
        LIMIT #{startIndex,jdbcType=BIGINT},#{pageSize,jdbcType=BIGINT}
    </select>

    <!-- 查询员工条数 -->
    <select id="getCount" parameterType="map" resultType="int">
        select
        count(*)
        from sys_user U where 1=1
        <if test="orgId != null and orgId != '' ">
            AND U.ORG_ID = #{orgId,jdbcType=BIGINT}
        </if>

        <if test="mobilePhone != null and mobilePhone != '' ">
            AND U.MOBILE_PHONE = #{mobilePhone,jdbcType=VARCHAR}
        </if>

        <if test="userChName != null and userChName != '' ">
            AND U.USER_CH_NAME like
            CONCAT(CONCAT('%',#{userChName,jdbcType=VARCHAR}),'%')
        </if>

        <if test="provinceId != null and provinceId != '' ">
            AND U.PROVINCE_ID = #{provinceId,jdbcType=BIGINT}
        </if>

        <if test="cityId != null and cityId != '' ">
            AND U.CITY_ID = #{cityId,jdbcType=BIGINT}
        </if>

        <if test="countryId != null and countryId != '' ">
            AND U.COUNTRY_ID = #{countryId,jdbcType=BIGINT}
        </if>
    </select>

    <!-- 通过userID查询用户对象信息 -->
    <select id="queryUserById" parameterType="int" resultMap="usersMap">
        SELECT <include refid="Base_users_List"/> FROM sys_user U,sys_org O
        WHERE U.ORG_ID = O.ORG_ID
        AND U.USER_ID=#{userId}
    </select>

    <!-- 查询每个省份性别的个数 -->
    <select id="getUserSexStaticties" resultType="map">
        select U.PROVINCE_NAME as provinceName,
        SUM(CASE WHEN U.USER_SEX=1 THEN 1 ELSE 0 END) as boy,
        SUM(CASE WHEN U.USER_SEX=2 THEN 1 ELSE 0 END) as girl,
        SUM(CASE WHEN U.USER_SEX=3 THEN 1 ELSE 0 END) as secrity
        from sys_user U GROUP BY U.PROVINCE_NAME
    </select>

    <!-- 查询每个省的总人数 -->
    <select id="getProvincePersonStaticties" resultType="map">
        select U.PROVINCE_NAME as name,SUM(1) as value
        from sys_user U GROUP BY U.PROVINCE_NAME
    </select>

    <!-- 通过组织id查询用户信息 -->
    <select id="getUserByOrgId" parameterType="int" resultMap="BaseResultMap">
        select <include refid="Base_Column_List"/> from sys_user
        where ORG_ID = #{orgId}
    </select>

    <!-- 通过用户和密码查询用户对象 -->
    <select id="checkUserIsExits" parameterType="user" resultMap="BaseResultMap">
        select <include refid="Base_Column_List"/> from sys_user
        WHERE USER_CH_NAME = #{userName} AND USER_PASSWORD = #{userPassword}
    </select>

    <!-- 去角色用户关系表中，通过userId查询roleId -->
    <select id="getRoleIdsByUserId" parameterType="long" resultType="string">
        select GROUP_CONCAT(DISTINCT ROLE_ID) as roleIds
        from sys_role_user_rel R
        where R.USER_ID=#{userId}
    </select>
    <!-- 去角色组织关系表中，通过orgId查询roleId -->
    <select id="getRoleIdsByOrgId" parameterType="long" resultType="string">
        select GROUP_CONCAT(DISTINCT ROLE_ID) as roleIds
        from sys_role_org_rel R
        where R.ORG_ID=#{orgId}
    </select>
    <!--

    insert into sys_user (USER_ID, ORG_ID, USER_NAME,
        USER_PASSWORD, MOBILE_PHONE, EMAIL,
        USER_CH_NAME, USER_BIRTHDAY, USER_SEX,
        USER_PHOTO_URL, PROVINCE_ID, PROVINCE_NAME,
        CITY_ID, CITY_NAME, COUNTRY_ID,
        CONTRY_NAME, HOBBY, INTRODUCE,
        MANAGER_ID, CREATED_DATE)
     -->
    <!--
    //[{orgId=1, mobilePhone=13378696977, email=1642483368@qq.com, userSex=1, userName=wuyanzu, userChName=吴彦祖},
     {orgId=1, mobilePhone=13378696988, email=1642483368@qq.com, userSex=3, userName=fangbingbing, userChName=范冰冰}]
     -->
    <!-- 导入excel文档的数据 -->
    <insert id="insertSheetData" parameterType="map">
        insert into sys_user(
        ORG_ID,
        MOBILE_PHONE,
        EMAIL,
        USER_SEX,
        USER_NAME,
        USER_CH_NAME,
        USER_PASSWORD,
        CREATED_DATE
        )values
        <foreach collection="list" item="user" separator=",">
            (
            #{user.orgId},
            #{user.mobilePhone},
            #{user.email},
            #{user.userSex},
            #{user.userName},
            #{user.userChName},
            '123456',
            now()
            )
        </foreach>
    </insert>
</mapper>